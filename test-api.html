<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Social Graph Scraper - API Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .button {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s;
        }
        .button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .output {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: rgba(46, 204, 113, 0.3); border: 1px solid #2ecc71; }
        .error { background: rgba(231, 76, 60, 0.3); border: 1px solid #e74c3c; }
        .info { background: rgba(52, 152, 219, 0.3); border: 1px solid #3498db; }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            margin: 5px 0;
        }
        input[type="text"]::placeholder, textarea::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üï∑Ô∏è Facebook Social Graph Scraper</h1>
        <div class="status info">
            <strong>API Test Interface</strong> - Test the backend functionality before using the Tampermonkey script
        </div>

        <div class="grid">
            <!-- API Status -->
            <div class="section">
                <h2>üì° API Status</h2>
                <button class="button" onclick="checkStatus()">Check Server Status</button>
                <button class="button" onclick="getStats()">Get Statistics</button>
                <div id="status-output" class="output">Click "Check Server Status" to test API connection...</div>
            </div>

            <!-- Queue Management -->
            <div class="section">
                <h2>üìã Queue Management</h2>
                <input type="text" id="queue-urls" placeholder="Enter Facebook URLs (comma-separated)">
                <input type="number" id="queue-depth" placeholder="Depth level (1-5)" min="1" max="5" value="1">
                <div>
                    <button class="button" onclick="addToQueue()">Add to Queue</button>
                    <button class="button" onclick="getQueue()">View Queue</button>
                    <button class="button" onclick="getNextProfile()">Get Next</button>
                </div>
                <div id="queue-output" class="output">Queue operations will appear here...</div>
            </div>

            <!-- Profile Testing -->
            <div class="section">
                <h2>üë§ Profile Testing</h2>
                <textarea id="profile-data" rows="8" placeholder='Enter test profile JSON:
{
  "url": "https://facebook.com/testuser",
  "name": "Test User",
  "depth": 1,
  "friends": [
    {"name": "Friend 1", "url": "https://facebook.com/friend1"}
  ]
}'></textarea>
                <div>
                    <button class="button" onclick="submitProfile()">Submit Profile</button>
                    <button class="button" onclick="getVisited()">Check Visited</button>
                </div>
                <div id="profile-output" class="output">Profile operations will appear here...</div>
            </div>

            <!-- Graph Operations -->
            <div class="section">
                <h2>üåê Graph Operations</h2>
                <div>
                    <button class="button" onclick="getGraph()">View Graph</button>
                    <button class="button" onclick="buildGraph()">Build Graph</button>
                    <button class="button" onclick="analyzeCommunities()">Analyze Communities</button>
                </div>
                <div id="graph-output" class="output">Graph operations will appear here...</div>
            </div>
        </div>

        <!-- Installation Guide -->
        <div class="section">
            <h2>üöÄ Quick Start Guide</h2>
            <ol>
                <li><strong>Backend:</strong> The server is running on <code>http://localhost:3000</code></li>
                <li><strong>Tampermonkey:</strong> Install the script from <code>tampermonkey/fb-scraper.user.js</code></li>
                <li><strong>Facebook:</strong> Navigate to any Facebook profile and start scraping</li>
                <li><strong>Analysis:</strong> Use the scripts to build graphs and analyze communities</li>
            </ol>
            
            <h3>üìù Available npm Scripts</h3>
            <div class="output">npm start              # Start the backend server
npm run build-graph     # Build graph from scraped profiles  
npm run analyze         # Analyze communities
npm run export-graph    # Export graph data
npm run stats           # Show graph statistics</div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';

        function displayOutput(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const status = isError ? '‚ùå' : '‚úÖ';
            element.textContent = `[${timestamp}] ${status} ${typeof data === 'object' ? JSON.stringify(data, null, 2) : data}`;
        }

        async function apiRequest(endpoint, method = 'GET', data = null) {
            try {
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }

                const response = await fetch(API_BASE + endpoint, options);
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Request failed');
                }
                
                return result;
            } catch (error) {
                throw new Error(`API Error: ${error.message}`);
            }
        }

        async function checkStatus() {
            try {
                const result = await apiRequest('/stats');
                displayOutput('status-output', result);
            } catch (error) {
                displayOutput('status-output', error.message, true);
            }
        }

        async function getStats() {
            try {
                const result = await apiRequest('/stats');
                displayOutput('status-output', result);
            } catch (error) {
                displayOutput('status-output', error.message, true);
            }
        }

        async function addToQueue() {
            const urls = document.getElementById('queue-urls').value.split(',').map(u => u.trim()).filter(u => u);
            const depth = parseInt(document.getElementById('queue-depth').value) || 1;
            
            if (urls.length === 0) {
                displayOutput('queue-output', 'Please enter at least one URL', true);
                return;
            }

            try {
                const result = await apiRequest('/queue', 'POST', { urls, depth });
                displayOutput('queue-output', result);
                document.getElementById('queue-urls').value = '';
            } catch (error) {
                displayOutput('queue-output', error.message, true);
            }
        }

        async function getQueue() {
            try {
                const result = await apiRequest('/queue');
                displayOutput('queue-output', result);
            } catch (error) {
                displayOutput('queue-output', error.message, true);
            }
        }

        async function getNextProfile() {
            try {
                const result = await apiRequest('/scrape/next');
                displayOutput('queue-output', result);
            } catch (error) {
                displayOutput('queue-output', error.message, true);
            }
        }

        async function submitProfile() {
            const profileText = document.getElementById('profile-data').value;
            
            if (!profileText.trim()) {
                displayOutput('profile-output', 'Please enter profile data', true);
                return;
            }

            try {
                const profileData = JSON.parse(profileText);
                const result = await apiRequest('/profile', 'POST', profileData);
                displayOutput('profile-output', result);
            } catch (error) {
                displayOutput('profile-output', error.message, true);
            }
        }

        async function getVisited() {
            try {
                const result = await apiRequest('/visited');
                displayOutput('profile-output', result);
            } catch (error) {
                displayOutput('profile-output', error.message, true);
            }
        }

        async function getGraph() {
            try {
                const result = await apiRequest('/graph');
                displayOutput('graph-output', `Graph: ${result.nodes.length} nodes, ${result.edges.length} edges`);
            } catch (error) {
                displayOutput('graph-output', error.message, true);
            }
        }

        async function buildGraph() {
            displayOutput('graph-output', 'Building graph... (this may take a while)');
            // Note: This would typically be done via the scripts, not the API
            displayOutput('graph-output', 'Use "npm run build-graph" in terminal to build the graph from scraped profiles');
        }

        async function analyzeCommunities() {
            displayOutput('graph-output', 'Analyzing communities... (this may take a while)');
            // Note: This would typically be done via the scripts, not the API
            displayOutput('graph-output', 'Use "npm run analyze" in terminal to perform community analysis');
        }

        // Initialize
        window.onload = function() {
            checkStatus();
        };
    </script>
</body>
</html>
